sap.ui.define(["oft/fiori/controller/BaseController"],function(e){"use strict";return e.extend("oft.fiori.controller.MainApp",{idleLogout:function(){var e;var o=this;window.onbeforeunload=function(){o.logOutApp("X")};window.onload=i;window.onmousemove=i;window.onmousedown=i;window.ontouchstart=i;window.onclick=i;window.onkeypress=i;window.addEventListener("scroll",i,true);function t(){sap.m.MessageBox.alert("Page expired, please login again!");if(window.top.location.href.split("/")[window.top.location.href.split("/").length-1]==="leadDetail"||window.top.location.href.split("/")[window.top.location.href.split("/").length-1]==="leadDetails"){window.top.location.href="/#/leadDetails"}else{window.top.location.href="/"}}function i(){clearTimeout(e);e=setTimeout(t,36e5)}},onLogout:function(){this.logOutApp()},onInit:function(){this.idleLogout();this.oRouter=sap.ui.core.UIComponent.getRouterFor(this)},onSubmit:function(){this.Login()},onLivePassword:function(e){console.log("Test")},Login:function(){var e={email:this.getView().byId("userid").getValue(),password:this.getView().byId("pwd").getValue()};var o=this;if(!e.email||!e.password){sap.m.MessageBox.error("User/password cannot be empty");return}$.post("/api/Users/login",e).done(function(e,t){o.getView().getModel("local").setProperty("/Authorization",e.id);o.getView().getModel().setHeaders({Authorization:e.id});o.secureToken=e.id;o.getView().getModel("local").setProperty("/CurrentUser",e.userId);o.getView().getModel().setUseBatch(false);var i=o;var r=[new sap.ui.model.Filter("TechnicalId",sap.ui.model.FilterOperator.EQ,e.userId)];var s={filters:r};var l=false;var n=[];o.ODataHelper.callOData(o.getOwnerComponent().getModel(),"/AppUsers","GET",{},{},o).then(function(o){var t=[];if(o.results.length!=0){for(var r=0;r<o.results.length;r++){n[o.results[r].TechnicalId]=o.results[r];if(o.results[r].TechnicalId===e.userId){i.getView().getModel("local").setProperty("/Role",o.results[r].Role);i.getView().getModel("local").setProperty("/UserName",o.results[r].UserName);i.getView().getModel("local").setProperty("/JoiningDate",o.results[r].JoiningDate);i.getView().getModel("local").setProperty("/LeaveQuota",o.results[r].LeaveQuota);i.getView().getModel("local").setProperty("/MobileNo",o.results[r].MobileNo);l=true}else{i.getView().getModel("local").setProperty("/Authorization","");t.push(o.results[r])}}if(l===true){i.getView().getModel("local").setProperty("/AppUsers",n);i.getView().getModel("local").setProperty("/AppUsersCopy",t);i.oRouter.navTo("newlead")}else{sap.m.MessageBox.error("The user is not authorized, Contact Anubhav")}}}).catch(function(e){})}).fail(function(e,o,t){sap.m.MessageBox.error("Login Failed, Please enter correct credentials")})}})});
//# sourceMappingURL=MainApp.controller.js.map
var oGuid;sap.ui.define(["oft/fiori/controller/BaseController","sap/m/MessageBox","sap/m/MessageToast","oft/fiori/models/formatter","sap/ui/model/Filter"],function(e,t,i,s,a){"use strict";return e.extend("oft.fiori.controller.newTrainer",{oSorter:null,formatter:s,simpleForm:null,endDate:null,onInit:function(){this.oRouter=sap.ui.core.UIComponent.getRouterFor(this);this.oRouter.attachRoutePatternMatched(this.herculis,this);var e=this},onBack:function(){sap.ui.getCore().byId("idApp").to("idView1")},onEmailChange:function(e){var t=e.getParameter("newValue");if(t){var i=/\S+@\S+\.\S+/;var s=i.test(t);e.getSource().setValueState(s?"Success":"Error")}else{e.getSource().setValueState("None")}},onUpdateFinished:function(e){var t=this.getView().byId("serverTable").getItems();if(t[this.selIndex-1]){var i=t[this.selIndex-1].getCells()[2].getText();var s="Students('"+i+"')";var a=this.getView().getModel().oData[s];t[this.selIndex-1].getCells()[2].setText(a.GmailId)}},onPressAdd:function(){var e=this.getView().getModel("local").getProperty("/TrainerModel");e.Courses.push({CourseName:null,FeeMode:null,FeeAmount:null,Active:true});this.getView().getModel("local").setProperty("/TrainerModel",e)},onPressDeleteRow:function(e){var t=e.getSource().getParent().getParent().getSelectedContextPaths();var i=[];t.forEach(e=>{i.push(parseInt(e.split("/")[3]))});i.sort((e,t)=>t-e);var s=this.getView().getModel("local").getProperty("/TrainerModel/Courses");i.forEach(e=>{s.splice(e,1)});this.getView().getModel("local").setProperty("/TrainerModel/Courses",s);e.getSource().getParent().getParent().removeSelections()},onSave:function(){if(this.getView().byId("idFirstName").getValue()===""){sap.m.MessageBox.error("FirstName is mandatory");return}var e=this.getView().getModel("local").getProperty("/newTrainer");var t=new Date;var i=this;var s=this.getView().getModel("local").getProperty("/TrainerModel");this.getView().setBusy(true);var a={FirstName:this.getView().byId("idFirstName").getValue().toLocaleUpperCase().toLocaleUpperCase(),LastName:this.getView().byId("idLastName").getValue(),JoiningDate:this.getView().byId("idJoiningDate").getDateValue(),Address:this.getView().byId("idAddress").getValue(),City:this.getView().byId("idCity").getSelectedKey(),Remarks:this.getView().byId("idRemarks").getValue(),ContactNo:this.getView().byId("idContactNo").getValue(),ContactNo1:this.getView().byId("idContactNo1").getValue(),AccountNo:this.getView().byId("idAccountNo").getValue(),AccountName:this.getView().byId("idAccountName").getValue(),IFSCCode:this.getView().byId("idIFSCCode").getValue(),Email:this.getView().byId("idEmail").getValue(),Experience:this.getView().byId("idExperienceYear").getValue()*12+this.getView().byId("idExperienceMonth").getValue()*1,JoiningDate:this.getView().byId("idJoiningDate").getValue(),PartTime:this.getView().byId("idPartTime").getSelected(),SchoolName:this.getView().byId("idSchoolName").getValue(),Courses:s.Courses?s.Courses.filter(e=>Boolean(e.CourseName)):[],AccountType:this.getView().byId("idAccountType").getValue(),PANNo:this.getView().byId("idPANNo").getValue(),SoftDelete:this.getView().byId("idSoftDelete").getSelected(),Update:"C"};if(this.flag==="trainerName"){this.ODataHelper.callOData(this.getOwnerComponent().getModel(),"/Trainers('"+oGuid+"')","PUT",{},a,this).then(function(e){sap.m.MessageToast.show("Trainer Updated Successfully");i.destroyMessagePopover();i.getView().setBusy(false)}).catch(function(e){i.getView().setBusy(false);i.oPopover=i.getErrorMessage(e);i.getView().setBusy(false)})}else{this.ODataHelper.callOData(this.getOwnerComponent().getModel(),"/Trainers","POST",{},a,this).then(function(e){sap.m.MessageToast.show("New Trainer Created Successfully");i.destroyMessagePopover();i.getView().setBusy(false)}).catch(function(e){i.getView().setBusy(false);i.oPopover=i.getErrorMessage(e);i.getView().setBusy(false)})}},getAdd8Mon:function(e){var t=new Date(e.getValue().substr(6,4),e.getValue().substr(3,2),e.getValue().substr(0,2));t.setMonth(t.getMonth()+1);var i=t.getMonth()+1;var s=t.getFullYear();if(e<10){e="0"+e}if(i<10){i="0"+i}var a=e+"."+i+"."+s;return a},onStartChange:function(e){var t=e.getSource().getValue();var i=t.split(".");var s=new Date(i[2],i[1]-1,i[0]);var a=this.formatter.getIncrementDate(s,1);if(e.getSource().sId=="idSimpleForm--startDate"){sap.ui.getCore().byId("idSimpleForm--endDate").setValue(a);sap.ui.getCore().byId("idSimpleForm--userEndDate").setValue(a)}else if(e.getSource().sId=="idSimpleFormRe--startDate"){sap.ui.getCore().byId("idSimpleFormRe--endDate").setValue(a);sap.ui.getCore().byId("idSimpleFormRe--userEndDate").setValue(a)}else{this.getView().byId("endDate").setValue(a);this.getView().byId("userEndDate").setValue(a)}},herculis:function(e){if(e.getParameter("name")!=="newTrainer"){return}var t=this;this.getView().getModel("/Trainers").setProperty("JoiningDate",this.formatter.getFormattedDate(0))},searchPopup:null,sId:"",onSelect:function(e){this.getCustomerPopup();this.flag="trainerName";var t=this.getView().getModel("i18n").getProperty("Trainer");this.searchPopup.setTitle(t);this.searchPopup.bindAggregation("items",{path:"/Trainers",template:new sap.m.DisplayListItem({label:"{FirstName}",value:"{LastName}"})})},onStudenIdChange:function(e){var t=e.getSource().oPropagatedProperties.oBindingContexts.undefined.sPath;t=t.split("/")[1];var i=this.getView().getModel().oData[t].StudentId;i="Students('"+i+"')";var s=this.getView().getModel().oData[i];if(s){var a=s.GmailId;e.getSource().setText(a)}},onCustomerIdChange:function(e){var t=e.getSource().oParent.oParent.oParent.oParent.mObjectBindingInfos.undefined.path;t=t.split("/")[1];var i=this.getView().getModel().oData[t].StudentId;i="Students('"+i+"')";var s=this.getView().getModel().oData[i];if(s){if(e.getSource().sId=="idSimpleForm--customerId"){sap.ui.getCore().byId("idSimpleForm--customerId").setValue(s.GmailId);sap.ui.getCore().byId("idSimpleForm--name").setText(s.Name)}else{sap.ui.getCore().byId("idSimpleFormRe--customerId").setValue(s.GmailId);sap.ui.getCore().byId("idSimpleFormRe--name").setText(s.Name)}}},onReassign:function(e){this.oDialogPopup.close();this.getReasgnPopup();var t=this.getView().getModel("i18n").getProperty("serverUpdate");this.ReasgnPopup.setTitle(t);if(!this.oSimpleFormRe){this.oSimpleFormRe=sap.ui.xmlfragment("idSimpleFormRe","oft.fiori.fragments.ServerSimpleForm",this);this.getView().addDependent(this.oSimpleFormRe);this.ReasgnPopup.addButton(new sap.m.Button({text:"Update",type:"Accept",press:[this.onReUpdate,this]}));this.ReasgnPopup.addButton(new sap.m.Button({text:"Close",type:"Reject",press:[this.onReClose,this]}))}var i=this.getView();var s=e.getSource().getParent().getContent()[0].getBindingContext().sPath;this.oSimpleFormRe.bindElement(s);sap.ui.getCore().byId("idSimpleFormRe--payDate").bindProperty("value",{path:"PaymentDate",type:"sap.ui.model.type.Date",formatOptions:{pattern:"dd.MM.YYYY"}});sap.ui.getCore().byId("idSimpleFormRe--serverUId").bindProperty("value","User");sap.ui.getCore().byId("idSimpleFormRe--startDate").bindProperty("value",{path:"StartDate",type:"sap.ui.model.type.Date",formatOptions:{pattern:"dd.MM.YYYY"}});sap.ui.getCore().byId("idSimpleFormRe--endDate").bindProperty("value",{path:"EndDate",type:"sap.ui.model.type.Date",formatOptions:{pattern:"dd.MM.YYYY"}});sap.ui.getCore().byId("idSimpleFormRe--userEndDate").bindProperty("value",{path:"UserEndDate",type:"sap.ui.model.type.Date",formatOptions:{pattern:"dd.MM.YYYY"}});sap.ui.getCore().byId("idSimpleFormRe--rdpPass").bindProperty("value","PassRDP");sap.ui.getCore().byId("idSimpleFormRe--passGui").bindProperty("value","PassSAP");sap.ui.getCore().byId("idSimpleFormRe--amount").bindProperty("value","Amount");sap.ui.getCore().byId("idSimpleFormRe--usage").bindProperty("value","Usage");sap.ui.getCore().byId("idSimpleFormRe--freeAccess").bindProperty("selected","FreeAccess");sap.ui.getCore().byId("idSimpleFormRe--extended").bindProperty("selected","Extended");sap.ui.getCore().byId("idSimpleFormRe--Remarks").bindProperty("value","Remarks");sap.ui.getCore().byId("idSimpleFormRe--cid").bindProperty("value","StudentId");sap.ui.getCore().byId("idSimpleFormRe--customerId").attachModelContextChange(this.onCustomerIdChange,this);this.ReasgnPopup.addContent(this.oSimpleFormRe)},cleartrainer:function(e){this.getView().byId("idFirstName").setValue("");this.getView().byId("idFirstName").setEnabled(true);this.getView().byId("idLastName").setValue("");this.getView().byId("idLastName").setEnabled(true);this.getView().byId("idJoiningDate").setValue("");this.getView().byId("idJoiningDate").setEnabled(true);this.getView().byId("idAccountName").setValue("");this.getView().byId("idAccountNo").setValue("");this.getView().byId("idAccountType").setValue("");this.getView().byId("idAddress").setValue("");this.getView().byId("idCity").setValue("");this.getView().byId("idContactNo").setValue("");this.getView().byId("idContactNo1").setValue("");this.getView().byId("idEmail").setValue("");this.getView().byId("idExperienceYear").setValue("");this.getView().byId("idExperienceMonth").setValue("");this.getView().byId("idSchoolName").setValue("");this.getView().byId("idPartTime").setSelected(false);this.getView().byId("idIFSCCode").setValue("");this.getView().byId("idPANNo").setValue("");this.getView().byId("idRemarks").setValue("");this.getView().byId("idSoftDelete").setSelected(false);this.getView().getModel("local").setProperty("/TrainerModel",{Courses:[]});this.flag=null;this.getView().byId("idTrainerCourse").removeSelections()},onClose:function(){this.oDialogPopup.close()},onReClose:function(){this.ReasgnPopup.close()},onSearch:function(e){var t=this.getQuery(e);if(t){var i=new sap.ui.model.Filter("Name",sap.ui.model.FilterOperator.Contains,t);var s=new sap.ui.model.Filter("GmailId",sap.ui.model.FilterOperator.Contains,t);var a=new sap.ui.model.Filter({filters:[i,s],and:false});var o=[a];this.searchPopup.getBinding("items").filter(o)}else{this.searchPopup.bindAggregation("items",{path:"/Students",template:new sap.m.DisplayListItem({label:"{Name}",value:"{GmailId}"})});this.searchPopup.getBinding("items").filter([])}},onConfirm:function(e){var t=this.getSelectedKey(e);if(this.flag==="trainerName"){var i="Trainers('"+t[2]+"')";var s=this.getView().getModel().oData[i];oGuid=t[2];s.ExperienceYear=Math.floor(s.Experience/12);s.ExperienceMonth=s.Experience%12;this.getView().getModel("local").setProperty("/TrainerModel",s);this.getView().getModel("local").setProperty("/TrainerModel/FirstName",s.FirstName);this.getView().byId("idFirstName").setValue(s.FirstName);this.getView().byId("idFirstName").setEnabled(false);this.getView().getModel("local").setProperty("/TrainerModel/LastName",s.LastName);this.getView().byId("idLastName").setValue(s.LastName);this.getView().byId("idLastName").setEnabled(false);this.getView().getModel("local").setProperty("/TrainerModel/JoiningDate",s.JoiningDate);if(s.JoiningDate){var a=this.onDateFormatted(s.JoiningDate);this.getView().byId("idJoiningDate").setValue(a);this.getView().byId("idJoiningDate").setEnabled(false)}else{this.getView().byId("idJoiningDate").setEnabled(true)}this.getView().getModel("local").setProperty("/TrainerModel/AccountName",s.AccountName);this.getView().byId("idAccountName").setValue(s.AccountName);this.getView().getModel("local").setProperty("/TrainerModel/AccountNo",s.AccountNo);this.getView().byId("idAccountNo").setValue(s.AccountNo);this.getView().getModel("local").setProperty("/TrainerModel/AccountType",s.AccountType);this.getView().byId("idAccountType").setValue(s.AccountType);this.getView().getModel("local").setProperty("/TrainerModel/Address",s.Address);this.getView().byId("idAddress").setValue(s.Address);this.getView().getModel("local").setProperty("/TrainerModel/City",s.City);this.getView().byId("idCity").setValue(s.City);this.getView().getModel("local").setProperty("/TrainerModel/ContactNo",s.ContactNo);this.getView().byId("idContactNo").setValue(s.ContactNo);this.getView().getModel("local").setProperty("/TrainerModel/ContactNo1",s.ContactNo1);this.getView().byId("idContactNo1").setValue(s.ContactNo1);this.getView().getModel("local").setProperty("/TrainerModel/IFSCCode",s.IFSCCode);this.getView().byId("idIFSCCode").setValue(s.IFSCCode);this.getView().getModel("local").setProperty("/TrainerModel/PANNo",s.PANNo);this.getView().byId("idPANNo").setValue(s.PANNo);this.getView().getModel("local").setProperty("/TrainerModel/Remarks",s.Remarks);this.getView().byId("idRemarks").setValue(s.Remarks);this.getView().getModel("local").setProperty("/TrainerModel/SoftDelete",s.SoftDelete);this.getView().byId("idSoftDelete").setSelected(s.SoftDelete)}},onWaiver:function(e){var t=e.getParameter("selected");if(e.getSource().sId=="__component0---idserver--freeAccess"){if(t===true){this.getView().byId("amount").setValue(0)}else{this.getView().byId("amount").setValue(2500)}}else if(e.getSource().sId=="idSimpleFormRe--freeAccess"){if(t===true){sap.ui.getCore().byId("idSimpleFormRe--amount").setValue(0)}else{sap.ui.getCore().byId("idSimpleFormRe--amount").setValue(2500)}}else{if(t===true){sap.ui.getCore().byId("idSimpleForm--amount").setValue(0)}else{sap.ui.getCore().byId("idSimpleForm--amount").setValue(2500)}}},onTabSearch:function(e){var t=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;var i=this.getQuery(e);if(i){var s;var a;if(t.test(i)){var o=this;var r={};var l=new sap.ui.model.Filter("GmailId","EQ",i);this.ODataHelper.callOData(this.getOwnerComponent().getModel(),"/Students","GET",{filters:[l]},r,this).then(function(e){var t=[new sap.ui.model.Filter("StudentId","EQ","'"+e.results[0].id+"'")];o.getView().byId("serverTable").getBinding("items").filter(t)}).catch(function(e){})}else{s=new sap.ui.model.Filter("User",sap.ui.model.FilterOperator.EQ,i);var n=new sap.ui.model.Filter({filters:[s],and:false});var d=[n];this.getView().byId("serverTable").getBinding("items").filter(d)}}else{this.getView().byId("serverTable").getBinding("items").filter([])}},deletetrainer:function(){var e=this;t.confirm("Do you want to delete the selected trainer?",function(t){if(t=="OK"){debugger;var i="/Trainers('"+oGuid+"')";e.ODataHelper.callOData(e.getOwnerComponent().getModel(),i,"DELETE",{},{},e).then(function(t){sap.m.MessageToast.show("Trainer Deleted succesfully");e.cleartrainer()}).catch(function(t){e.getView().setBusy(false);e.oPopover=e.getErrorMessage(t);e.getView().setBusy(false)})}},"Confirmation")},onClearScreen:function(){this.getView().getModel("local").setProperty("/newServer/User",null);this.getView().getModel("local").setProperty("/newServer/PassSAP",null);this.getView().getModel("local").setProperty("/newServer/PassRDP",null)},onDelete:function(e){var i=this;t.confirm("Do you want to delete the selected records?",function(e){if(e=="OK"){var t=i.getView().byId("serverTable").getSelectedContexts();for(var s=0;s<t["length"];s++){i.ODataHelper.callOData(i.getOwnerComponent().getModel(),t[s].sPath,"DELETE",{},{},i).then(function(e){sap.m.MessageToast.show("Deleted succesfully")}).catch(function(e){i.getView().setBusy(false);i.oPopover=i.getErrorMessage(e);i.getView().setBusy(false)})}}},"Confirmation")},onSwitchToggle:function(e){var t=e.getSource().getState();var i=new Date;var s=this.getQuery(e);if(t===true){this.getView().byId("serverTable").getBinding("items").filter(null)}else{var a=new sap.ui.model.Filter("EndDate","GT",i);var o=new sap.ui.model.Filter({filters:[a]});var r=[o];this.getView().byId("serverTable").getBinding("items").filter(r)}},passwords:"",onEmail:function(){var e=this;var t=e.getView().byId("serverTable").getSelectedContexts();for(var i=0;i<t["length"];i++){var s=t[i].getModel().getProperty(t[i].getPath());if(this.passwords===""){this.passwords=prompt("Please enter your password","");if(this.passwords===""){sap.m.MessageBox.error("Blank Password not allowed");return}}s.password=this.passwords;$.post("/sendServerEmail",s).done(function(e,t){sap.m.MessageToast.show("Email sent successfully")}).fail(function(t,i,s){e.passwords="";sap.m.MessageBox.error(t.responseText)})}},onDataExport:function(e){var t=this.getView().byId("idSwitch").getState();if(t==true){$.ajax({type:"GET",url:"ServerDownload",success:function(e){sap.m.MessageToast.show("File Downloaded succesfully")},error:function(e,t,i){sap.m.MessageToast.show("error in downloading the excel file")}})}else{$.ajax({type:"GET",url:"ServerDownloadAct",success:function(e){sap.m.MessageToast.show("File Downloaded succesfully")},error:function(e,t,i){sap.m.MessageToast.show("error in downloading the excel file")}})}}})});
//# sourceMappingURL=newTrainer.controller.js.map
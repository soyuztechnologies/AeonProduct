sap.ui.define(["oft/fiori/controller/BaseController","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/m/routing/RouteMatchedHandler","sap/ui/Device"],function(e,t,s,a,i){"use strict";return e.extend("oft.fiori.controller.dailyTasks",{allMasterData:{Tasks:[]},onInit:function(){var e=this.getView().byId("idCoDate1");e.setDateValue(new Date);var t=this.getOwnerComponent().getRouter();t.attachRoutePatternMatched(this.herculis,this);var s=this.getModel("local").getProperty("/CurrentUser");if(s){var a=this.getModel("local").oData.AppUsers[s].UserName;this.getView().byId("idUser").setText(a)}debugger;var i=this;var e=i.getView().byId("idCoDate1");$.post("/getWorkAggregate",{currentDate:e.getDateValue(),userId:s}).done(function(e,t){var s=new sap.ui.model.json.JSONModel;s.setData({PieData:e});debugger;for(var a=0;a<e.length;a++){if(e[a].taskType==="GB"){e[a].taskType="Google Business Post"}if(e[a].taskType==="LP"){e[a].taskType="Linkedin Post"}if(e[a].taskType==="FP"){e[a].taskType="Facebook Post"}if(e[a].taskType==="TW"){e[a].taskType="Tweets"}if(e[a].taskType==="ST"){e[a].taskType="SEO Tools MR,GSA"}if(e[a].taskType==="AB"){e[a].taskType="Anu Bot"}if(e[a].taskType==="CK"){e[a].taskType="Competitor Kill"}if(e[a].taskType==="CI"){e[a].taskType="Customer Interaction Calls/Mails"}if(e[a].taskType==="PT"){e[a].taskType="Pinetrust Post"}if(e[a].taskType==="SW"){e[a].taskType="SAP Server Work"}if(e[a].taskType==="WD"){e[a].taskType="Website Development"}if(e[a].taskType==="WR"){e[a].taskType="Website Review posts"}if(e[a].taskType==="TR"){e[a].taskType="Trainings"}if(e[a].taskType==="TM"){e[a].taskType="Team Meeting"}if(e[a].taskType==="TE"){e[a].taskType="Team Event"}if(e[a].taskType==="SE"){e[a].taskType="Self Learning"}if(e[a].taskType==="OT"){e[a].taskType="Others"}}i.getView().setModel(s,"PieChartModel");debugger}).fail(function(e,t,s){})},herculis:function(){this.getView().byId("idCoDate1").setDateValue(new Date);this.getModel("local").setProperty("/tasks/CrDate",new Date);this.currentUser=this.getModel("local").getProperty("/CurrentUser");this.fromDate=new Date;this.toDate=new Date;this.fromDate.setMilliseconds(0);this.fromDate.setSeconds(0);this.fromDate.setMinutes(0);this.fromDate.setHours(0);this.toDate.setMilliseconds(0);this.toDate.setSeconds(59);this.toDate.setMinutes(59);this.toDate.setHours(23);this.reloadTasks()},reloadTasks:function(e){var t=this.getModel("local").getProperty("/Role");this.getView().byId("idCoTable").bindItems({path:"/tasks",template:new sap.m.ColumnListItem({cells:[new sap.m.Text({text:"{taskWorkedOn}"}),new sap.m.Text({text:{path:"CrDate",type:"sap.ui.model.type.Date",formatOptions:{pattern:"dd.MM.YYYY"}}}),new sap.m.Text({text:{path:"taskType",formatter:".formatter.getTaskText"}}),new sap.m.Text({text:"{noOfHours}"}),new sap.m.Link({text:{path:"link"}}),new sap.m.Button({text:"Delete",icon:"sap-icon://delete",press:[this.onDelete,this]})]})});if(t=="Admin"){var s=[new sap.ui.model.Filter("CrDate",sap.ui.model.FilterOperator.BT,this.fromDate,this.toDate)];this.getView().byId("idCoTable").getBinding("items").filter(s)}else{this.getView().byId("idUser").setVisible(true);var s=[new sap.ui.model.Filter("CreatedBy","EQ","'"+this.currentUser+"'"),new sap.ui.model.Filter("CrDate",sap.ui.model.FilterOperator.BT,this.fromDate,this.toDate)];this.getView().byId("idCoTable").getBinding("items").filter(s)}},onUpdateFinished:function(e){var t=e.getSource();var s=t.getItems();var a=s.length;var i;var o=this.getView().byId("idCoTable").getBinding("items").getLength();var r=this.getView().byId("idCoTable").getBinding("items");var n=0;for(var l=0;l<o;l++){n=n+parseFloat(r.getContexts()[l].oModel.getProperty(r.getContexts()[l].sPath).noOfHours)}this.getView().byId("idTxt").setText("Total number of tasks are "+r.getLength()+" and Total number of hours worked are "+n+"");var p=this.getModel("local").getProperty("/CurrentUser");var d=this;debugger;var g=d.getView().byId("idCoDate1");$.post("/getWorkAggregate",{currentDate:g.getDateValue(),userId:p}).done(function(e,t){var s=new sap.ui.model.json.JSONModel;s.setData({PieData:e});for(var a=0;a<e.length;a++){if(e[a].taskType==="GB"){e[a].taskType="Google Business Post"}if(e[a].taskType==="LP"){e[a].taskType="Linkedin Post"}if(e[a].taskType==="FP"){e[a].taskType="Facebook Post"}if(e[a].taskType==="TW"){e[a].taskType="Tweets"}if(e[a].taskType==="ST"){e[a].taskType="SEO Tools MR,GSA"}if(e[a].taskType==="AB"){e[a].taskType="Anu Bot"}if(e[a].taskType==="CK"){e[a].taskType="Competitor Kill"}if(e[a].taskType==="CI"){e[a].taskType="Customer Interaction Calls/Mails"}if(e[a].taskType==="PT"){e[a].taskType="Pinetrust Post"}if(e[a].taskType==="SW"){e[a].taskType="SAP Server Work"}if(e[a].taskType==="WD"){e[a].taskType="Website Development"}if(e[a].taskType==="WR"){e[a].taskType="Website Review posts"}if(e[a].taskType==="TR"){e[a].taskType="Trainings"}if(e[a].taskType==="TM"){e[a].taskType="Team Meeting"}if(e[a].taskType==="TE"){e[a].taskType="Team Event"}if(e[a].taskType==="SE"){e[a].taskType="Self Learning"}if(e[a].taskType==="OT"){e[a].taskType="Others"}}d.getView().setModel(s,"PieChartModel")}).fail(function(e,t,s){})},onDateChange:function(e){var t=this.getModel("local").getProperty("/Role");var s=e.getSource().getProperty("dateValue");var s=e.getSource().getProperty("dateValue");var a=new Date(s+1);var i=[];var o=null;var r=null;s.setMilliseconds(0);s.setSeconds(0);s.setMinutes(0);s.setHours(0);a.setMilliseconds(0);a.setSeconds(59);a.setMinutes(59);a.setHours(23);if(t=="Admin"){var n=new sap.ui.model.Filter("CrDate","BT",s,a);this.getView().byId("idCoTable").getBinding("items").filter(n,true)}else{var n=[new sap.ui.model.Filter("CreatedBy","EQ","'"+this.currentUser+"'"),new sap.ui.model.Filter("CrDate",sap.ui.model.FilterOperator.BT,s,a)];this.getView().byId("idCoTable").getBinding("items").filter(n,true)}},onDelete:function(e){var t=this;var s=e.getSource().getBindingContext().getPath();sap.m.MessageBox.confirm("Do you want to delete the selected records?",function(e){if(e=="OK"){t.ODataHelper.callOData(t.getOwnerComponent().getModel(),s,"DELETE",{},{},t).then(function(e){sap.m.MessageToast.show("Deleted succesfully")}).catch(function(e){t.getView().setBusy(false);t.oPopover=t.getErrorMessage(e);t.getView().setBusy(false)})}},"Confirmation")},onSave:function(e){var t=this;var s=this.getView().getModel("local").getProperty("/task");var a=sap.ui.core.format.DateFormat.getDateInstance({pattern:"yyyy-MM-dd"});s.taskWorkedOn=this.getView().byId("idWOn").getValue();if(this.getView().byId("idWH").getValue()<="8"){if(this.getView().byId("idWH").getValue()!="0"){s.noOfHours=this.getView().byId("idWH").getValue();var i=this.getView().byId("idCoDate1");var o=i.getDateValue();i.setDateValue(new Date(o));s.CrDate=i.getDateValue();s.taskType=this.getView().byId("idTaskType").getSelectedKey();s.link=this.getView().byId("idLink").getValue();s.remarks="";this.ODataHelper.callOData(this.getOwnerComponent().getModel(),"/tasks","POST",{},s,this).then(function(e){t.getView().setBusy(false);sap.m.MessageToast.show("Data Saved Successfully");var s=o;var a=new Date(s+1);s.setMilliseconds(0);s.setSeconds(0);s.setMinutes(0);s.setHours(0);a.setMilliseconds(0);a.setSeconds(59);a.setMinutes(59);a.setHours(23);var i=t.getModel("local").getProperty("/Role");if(i=="Admin"){var r=new sap.ui.model.Filter("CrDate","BT",s,a);t.getView().byId("idCoTable").getBinding("items").filter(r,true)}else{var r=[new sap.ui.model.Filter("CreatedBy",sap.ui.model.FilterOperator.EQ,"'"+t.currentUser+"'"),new sap.ui.model.Filter("CrDate",sap.ui.model.FilterOperator.BT,s,a)];t.getView().byId("idCoTable").getBinding("items").filter(r,true)}}).catch(function(e){t.getView().setBusy(false);var s=t.getErrorMessage(e)})}else{sap.m.MessageToast.show("Hour with zero value not allowed")}}else{sap.m.MessageToast.show("Hour greater that 8 value not allowed")}}})});
//# sourceMappingURL=dailyTasks.controller.js.map
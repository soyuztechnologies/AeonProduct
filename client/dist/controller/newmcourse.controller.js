sap.ui.define(["oft/fiori/controller/BaseController","sap/m/MessageBox","sap/m/MessageToast","oft/fiori/models/formatter","sap/ui/model/Filter"],function(e,t,s,r,o){"use strict";return e.extend("oft.fiori.controller.newmcourse",{formatter:r,courseGUID:"",Updatecourse:"",oCourse:"",onInit:function(){this.oRouter=sap.ui.core.UIComponent.getRouterFor(this);this.oRouter.attachRoutePatternMatched(this.herculis,this);this.Updatecourse=false;var e=this.getModel("local").getProperty("/CurrentUser");if(e){var t=this.getModel("local").oData.AppUsers[e].UserName;this.getView().byId("idUser").setText(t)}},clearForm:function(){},onBack:function(){sap.ui.getCore().getView().byId("idApp").to("idView1")},herculis:function(e){if(e.getParameter("name")!=="newmcourse"){return}},onSave:function(e){var t=e;console.log(this.getView().getModel("local").getProperty("/newmcourse"));var s=this;s.getView().setBusy(true);var r=this.getView().getModel("local").getProperty("/newmcourse");if(r.CourseFee<r.MinFees){s.getView().setBusy(false);sap.m.MessageBox.error("Min Fees Cannot be greater than Course Fee");return}switch(s.Updatecourse){case true:var o={CourseName:r.CourseName.toUpperCase(),CourseFee:r.CourseFee,MinFees:r.MinFees,WebLink:r.WebLink,CourseDuration:r.CourseDuration,Category:r.Category,CourseText:r.CourseText,youTube:r.youTube,EmailTemplate:r.EmailTemplate,ChangedBy:"",ChangedOn:new Date};var a="/CoursesMst";a=a+"("+"'"+s.courseGUID+"'"+")";this.ODataHelper.callOData(this.getOwnerComponent().getModel(),a,"PUT",{},o,this).then(function(e){s.getView().setBusy(false);s.onClearScreen();sap.m.MessageToast.show("Course Details Updated successfully");s.destroyMessagePopover()}).catch(function(e){s.getView().setBusy(false);var t=s.getErrorMessage(e)});break;case false:var o={CourseName:r.CourseName.toUpperCase(),CourseFee:r.CourseFee,MinFees:r.MinFees,WebLink:r.WebLink,CourseDuration:r.CourseDuration,Category:r.Category,CourseText:r.CourseText,youTube:r.youTube,EmailTemplate:r.EmailTemplate,CreatedOn:new Date,CreatedBy:""};this.ODataHelper.callOData(this.getOwnerComponent().getModel(),"/CoursesMst","POST",{},o,this).then(function(e){s.getView().setBusy(false);s.onClearScreen();sap.m.MessageToast.show("New Course Saved successfully");s.destroyMessagePopover()}).catch(function(e){s.getView().setBusy(false);var t=s.getErrorMessage(e)});break}},onSelect:function(e){this.sId=e.getSource().getId();var t="",s="";if(this.sId.indexOf("idCourse")!==-1){this.getCourseMstPopUp();var r=this.getView().getModel("i18n").getProperty("courseMst");this.searchPopup.setTitle(r);this.searchPopup.bindAggregation("items",{path:"/CoursesMst",template:new sap.m.DisplayListItem({label:"{CourseName}",value:"{Category}"})})}},onConfirm:function(e){if(this.sId.indexOf("idCourse")!==-1){var t=e.getParameter("selectedItem");var s=t.getBindingContext();if(s){var r=this;var o={};var a=new sap.ui.model.Filter("CourseName","EQ",s.getObject().CourseName);this.ODataHelper.callOData(this.getOwnerComponent().getModel(),"/CoursesMst","GET",{filters:[a]},o,this).then(function(e){if(e.results.length!=0){r.getView().byId("idCourse").setValue(e.results[0].CourseName);r.getView().byId("idCourseFee").setValue(e.results[0].CourseFee);r.getView().byId("idCourseFee").setValue(e.results[0].CourseFee);r.getView().byId("idCourseDuration").setValue(e.results[0].CourseDuration);if(e.results[0].MinFees){r.getView().byId("idMinFees").setValue(e.results[0].MinFees);r.getView().byId("idCategory").setSelectedKey(e.results[0].Category);r.getView().byId("idDesc").setValue(e.results[0].CourseText);r.getView().byId("idSite").setValue(e.results[0].WebLink);r.getView().byId("idYouTube").setValue(e.results[0].youTube);r.getView().byId("idEmailTemplate").setValue(e.results[0].EmailTemplate)}else{r.getView().byId("idMinFees").setValue(0)}r.getView().byId("idCreate").setText("Update");r.Updatecourse=true;r.courseGUID=e.results[0].id}}).catch(function(e){r.getView().byId("idCreate").setText("Create");r.Updatecourse=false})}}},onCourse:function(e){this.getView().byId("idCourse").setEnabled(true)},suggestionItemSelected:function(e){var t=e.getParameter("selectedItem");var s=t.getBindingContext();if(s){var r=this;var o={};var a=new sap.ui.model.Filter("CourseName","EQ",s.getObject().CourseName);this.ODataHelper.callOData(this.getOwnerComponent().getModel(),"/CoursesMst","GET",{filters:[a]},o,this).then(function(e){if(e.results.length!=0){r.getView().byId("idCourse").setValue(e.results[0].CourseName);r.getView().byId("idCourseFee").setValue(e.results[0].CourseFee);if(e.results[0].MinFees){r.getView().byId("idMinFees").setValue(e.results[0].MinFees);r.getView().byId("idCategory").setSelectedKey(e.results[0].Category);r.getView().byId("idDesc").setValue(e.results[0].CourseText);r.getView().byId("idSite").setValue(e.results[0].WebLink);r.getView().byId("idYouTube").setValue(e.results[0].youTube)}else{r.getView().byId("idMinFees").setValue(0)}r.getView().byId("idCreate").setText("Update");r.Updatecourse=true;r.courseGUID=e.results[0].id}}).catch(function(e){r.getView().byId("idCreate").setText("Create");r.Updatecourse=false})}},onEnter:function(e){this.oCourse=e.getParameters()},onDeleteCourse:function(e){var s=this;t.confirm("Do you want to delete the selected records?",function(e){if(e=="OK"){debugger;var t="/CoursesMst('"+s.courseGUID+"')";s.ODataHelper.callOData(s.getOwnerComponent().getModel(),t,"DELETE",{},{},s).then(function(e){sap.m.MessageToast.show("Deleted succesfully");s.onClearScreen()}).catch(function(e){s.getView().setBusy(false);s.oPopover=s.getErrorMessage(e);s.getView().setBusy(false)})}},"Confirmation")},onClearScreen:function(e){this.getView().getModel("local").setProperty("/newmcourse",{Category:"",CourseName:"",CourseDuration:"",CourseFee:0,MinFees:0,WebLink:"",CourseText:"",CreatedOn:"",CreatedBy:"",ChangedBy:"",ChangedOn:"",youTube:"",id:""});this.getView().byId("idCreate").setText("Create");this.Updatecourse=false;this.courseGUID=null}})});
//# sourceMappingURL=newmcourse.controller.js.map